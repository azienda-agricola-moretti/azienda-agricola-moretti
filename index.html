<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />

  <title>Azienda Agricola Moretti</title>
  <meta name="description" content="Hub contatti - Azienda Agricola Moretti" />

  <link rel="canonical" href="https://azienda-agricola-moretti.github.io/azienda-agricola-moretti/" />

  <meta property="og:type" content="website" />
  <meta property="og:locale" content="it_IT" />
  <meta property="og:title" content="Azienda Agricola Moretti" />
  <meta property="og:description" content="Contatti, indicazioni, social e sito ufficiale" />
  <meta property="og:url" content="https://azienda-agricola-moretti.github.io/azienda-agricola-moretti/" />
  <meta property="og:image" content="https://azienda-agricola-moretti.github.io/azienda-agricola-moretti/og.jpg" />

  <meta name="theme-color" content="#2C1C14" />
  <meta name="referrer" content="no-referrer" />

  <!-- Best-effort CSP for static hosting (GitHub Pages) -->
  <meta http-equiv="Content-Security-Policy"
    content="
      default-src 'self';
      img-src 'self' https: data:;
      style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
      font-src https://fonts.gstatic.com;
      script-src 'self' 'unsafe-inline';
      frame-src https://www.youtube.com https://www.youtube-nocookie.com;
      child-src https://www.youtube.com https://www.youtube-nocookie.com;
      connect-src 'self';
      base-uri 'self';
      form-action 'self';
      upgrade-insecure-requests;
    ">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --brand:#2C1C14;

      --bg:#FFFFFF;
      --ivory:#FBF8F5;

      --text:#0B1220;
      --muted: rgba(78,74,69,.84);

      --shadow: 0 14px 34px rgba(11,18,32,.08);
      --shadow2: 0 10px 22px rgba(11,18,32,.08);
      --radius:24px;

      --focus: rgba(44,28,20,.18);

      --tap:44px;
    }

    *{box-sizing:border-box}
    html,body{margin:0}

    body{
      font-family:"Montserrat", ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background: var(--bg);
      padding:22px 14px calc(108px + env(safe-area-inset-bottom));
      -webkit-text-size-adjust:100%;
      text-rendering: optimizeLegibility;
    }

    a, button { -webkit-tap-highlight-color: transparent; }

    .wrap{max-width:640px;margin:0 auto}
    .card{
      background:#fff;
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }

    /* ✅ LOGO più grande */
    .logo-wrap{
      display:flex;
      justify-content:center;
      padding: clamp(18px, 5vw, 34px) 16px;
      background:#fff;
    }
    .logo{
      display:block;
      width: min(620px, 96vw);
      height:auto;
      max-height:150px;
      object-fit:contain;
    }

    /* ✅ HERO più arioso + leggibile */
    .hero{
      position:relative;
      padding: clamp(22px, 5vw, 34px) 20px;
      text-align:center;
      background: var(--ivory);
      overflow:hidden;
      border-bottom: 1px solid rgba(44,28,20,.08);
    }
    .hero::before{
      content:"";
      position:absolute;
      inset:0;
      background:
        linear-gradient(rgba(251,248,245,.92), rgba(251,248,245,.92)),
        url("./hero-bg.jpg") center / cover no-repeat;
      filter: grayscale(6%) contrast(.98) brightness(1.03);
      z-index:0;
    }
    .hero > *{position:relative; z-index:1;}

    h1{
      margin:0;
      font-size: clamp(24px, 5.6vw, 36px);
      letter-spacing:-.04em;
      line-height:1.08;
      font-weight:800;
      color: var(--brand);
    }

    .sub{
      margin:12px auto 0;
      max-width:560px;
      color: var(--muted);
      font-size:15px;
      line-height:1.45;
      font-weight:650;
    }
    .sub strong{font-weight:900;color:var(--brand);}

    /* ✅ Pills più pulite */
    .pills{
      margin: 14px auto 0;
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
      max-width: 560px;
    }
    .pill{
      font-size:12px;
      font-weight:900;
      letter-spacing:.02em;
      padding: 8px 12px;
      border-radius:999px;
      background: rgba(255,255,255,.85);
      border:1px solid rgba(44,28,20,.10);
      color: rgba(44,28,20,.92);
      white-space:nowrap;
    }

    .actions{
      padding:14px 18px 18px;
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
      background:#fff;
    }
    @media (min-width:420px){
      .actions{ grid-template-columns: 1fr 1fr; }
    }

    .btn{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      text-decoration:none;
      border-radius:18px;
      padding:16px 16px;
      font-weight:900;
      border:1px solid rgba(44,28,20,.10);
      background:#fff;
      color:var(--text);
      box-shadow:0 1px 0 rgba(11,18,32,.03);
      transition: transform .08s ease, box-shadow .18s ease, border-color .18s ease;
      min-width:0;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      cursor:pointer;
      min-height: var(--tap);
    }
    .btn:hover{box-shadow:var(--shadow2); transform:translateY(-1px); border-color: rgba(44,28,20,.18)}
    .btn:active{transform:translateY(0px); box-shadow:0 8px 18px rgba(11,18,32,.10)}
    .btn:focus{outline:none}
    .btn:focus-visible{outline:3px solid var(--focus); outline-offset:2px}

    .btn.primary{
      background:var(--brand);
      color:#fff;
      border-color:transparent;
      box-shadow:0 14px 26px rgba(44,28,20,.18);
    }

    .i{
      width:20px;height:20px;
      stroke: var(--brand);
      stroke-width:2;
      fill:none;
      stroke-linecap:round;
      stroke-linejoin:round;
      flex:0 0 auto;
      display:block;
      margin-top:1px;
    }
    .btn.primary .i, .sbtn.primary .i{ stroke:#fff; }

    .wa-fill{
      width:20px;height:20px;
      flex:0 0 auto;
      display:block;
      color: currentColor;
    }

    .section{
      padding:18px;
      background:#fff;
    }
    .section.alt{ background: var(--ivory); }

    .section h2{
      margin:0 0 12px;
      font-size:13px;
      letter-spacing:.14em;
      text-transform:uppercase;
      color:rgba(78,74,69,.82);
      font-weight:900;
    }

    .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:12px;
    }
    @media (min-width:560px){
      .grid{grid-template-columns:1fr 1fr}
    }

    .tile{
      display:flex;
      align-items:flex-start;
      gap:12px;
      padding:14px;
      border:1px solid rgba(44,28,20,.10);
      border-radius:18px;
      background:#fff;
      transition: box-shadow .18s ease, transform .08s ease, border-color .18s ease;
      min-width:0;
    }
    .section.alt .tile{ background: rgba(255,255,255,.92); }
    .tile:hover{
      box-shadow:var(--shadow2);
      transform:translateY(-1px);
      border-color: rgba(44,28,20,.18);
    }

    .tile b{display:block; font-weight:900; color:var(--brand);}
    .small{color:rgba(78,74,69,.86);font-size:13px;margin-top:4px;line-height:1.45;font-weight:600}

    .tile a{color:inherit;text-decoration:none}
    .tile a:hover{text-decoration:underline}

    .tile.noicon{ gap:0; }
    .tile.noicon b{ margin:0; }

    /* CTA tap-friendly dentro tile */
    .mini-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .mini-btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-height: var(--tap);
      padding: 10px 12px;
      border-radius: 14px;
      border:1px solid rgba(44,28,20,.10);
      background:#fff;
      font-weight:900;
      font-size:13px;
      text-decoration:none;
      color:var(--text);
      box-shadow:0 1px 0 rgba(11,18,32,.03);
    }
    .mini-btn:focus{outline:none}
    .mini-btn:focus-visible{outline:3px solid var(--focus); outline-offset:2px}

    /* Orari più leggibili */
    .hours{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:8px;
    }
    .row{
      display:flex;
      justify-content:space-between;
      gap:12px;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.7);
      border:1px solid rgba(44,28,20,.08);
      font-size:13px;
      font-weight:800;
      color: rgba(44,28,20,.9);
    }
    .row span:last-child{color: rgba(78,74,69,.92); font-weight:900}
    .row.muted{opacity:.75}

    /* ✅ VIDEO: click-to-load (compatibile) + overlay */
    .video{
      margin:14px auto 0;
      max-width: 600px;
      border-radius:18px;
      overflow:hidden;
      box-shadow: 0 14px 30px rgba(0,0,0,.10);
      border:1px solid rgba(44,28,20,.10);
      background:#000;
      position:relative;
      aspect-ratio: 16/9;
    }
    .video button{
      all:unset;
      cursor:pointer;
      display:block;
      width:100%;
      height:100%;
      position:relative;
      background:
        linear-gradient(rgba(0,0,0,.25), rgba(0,0,0,.25)),
        url("./video-poster.jpg") center / cover no-repeat;
    }
    .video button:focus{outline:none}
    .video button:focus-visible{outline:3px solid var(--focus); outline-offset:2px}
    .play{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .play span{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width:64px;
      height:64px;
      border-radius:999px;
      background: rgba(255,255,255,.92);
      border:1px solid rgba(44,28,20,.18);
      box-shadow: 0 10px 26px rgba(0,0,0,.18);
    }
    .play svg{ width:26px; height:26px; fill: var(--brand); transform: translateX(1px); }

    .video iframe{
      display:block;
      width:100%;
      height:100%;
      border:0;
    }

    .social-row{
      display:flex;
      gap:16px;
      justify-content:center;
      align-items:center;
      flex-wrap:wrap;
      padding-top:2px;
    }
    .soc{
      width:var(--tap);
      height:var(--tap);
      display:flex;
      align-items:center;
      justify-content:center;
      text-decoration:none;
      background: rgba(255,255,255,.75);
      border-radius:999px;
      border:1px solid rgba(44,28,20,.10);
      transition: transform .08s ease, box-shadow .18s ease, border-color .18s ease;
      box-shadow: 0 10px 20px rgba(11,18,32,.06);
    }
    .soc:hover{
      transform: translateY(-1px);
      box-shadow: var(--shadow2);
      border-color: rgba(44,28,20,.18);
    }
    .soc:focus{outline:none}
    .soc:focus-visible{outline:3px solid var(--focus); outline-offset:2px}
    .soc svg{ width:22px; height:22px; display:block; }
    .soc svg path{ fill: var(--brand); }

    .sticky{
      position:fixed;
      left:0; right:0; bottom:0;
      padding:10px 12px calc(12px + env(safe-area-inset-bottom));
      background:rgba(251,248,245,.92);
      backdrop-filter: blur(12px);
      border-top:1px solid rgba(231,225,219,.95);
      z-index:999;
    }
    .sticky .inner{
      max-width:640px;
      margin:0 auto;
      display:grid;
      grid-template-columns: 2fr 1fr 1fr; /* WhatsApp più importante */
      gap:10px;
    }
    .sbtn{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:12px 10px;
      border-radius:18px;
      border:1px solid rgba(44,28,20,.10);
      background:#fff;
      color:var(--text);
      font-weight:900;
      text-decoration:none;
      box-shadow:0 10px 20px rgba(11,18,32,.08);
      font-size:14px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      min-height: var(--tap);
    }
    .sbtn.primary{
      background:var(--brand);
      color:#fff;
      border-color:transparent;
      box-shadow:0 14px 26px rgba(44,28,20,.16);
    }
    .sbtn:focus{outline:none}
    .sbtn:focus-visible{outline:3px solid var(--focus); outline-offset:2px}
    .lbl{min-width:0; overflow:hidden; text-overflow:ellipsis}
    @media (max-width:360px){
      .lbl{display:none}
      .sbtn{gap:0}
      .sticky .inner{grid-template-columns: 1fr 1fr 1fr;}
    }

    @media (prefers-reduced-motion: reduce){
      *{scroll-behavior:auto !important}
      .btn,.tile,.soc{transition:none}
      .btn:hover,.tile:hover,.soc:hover{transform:none}
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">

      <div class="logo-wrap">
        <img class="logo" src="./logo%20moretti.jpg" alt="Azienda Agricola Moretti" loading="eager" decoding="async">
      </div>

      <div class="hero">
        <h1>Azienda Agricola Moretti</h1>
        <div class="sub">
          <strong>Funghi km 0</strong> • Fresco • Linea gelo • Trasformati • Forniture B2B<br>
          Marino (RM) • Store Eataly Roma
        </div>

        <!-- ✅ Solo 2 pill (più premium) -->
        <div class="pills" aria-label="Punti di forza">
          <div class="pill">KM 0</div>
          <div class="pill">B2B &amp; Privati</div>
        </div>
      </div>

      <div class="actions" aria-label="Azioni principali">
        <a class="btn primary" id="waTop" href="#" aria-label="Scrivi su WhatsApp">
          <svg class="wa-fill" viewBox="0 0 24 24" aria-hidden="true">
            <path fill="currentColor" d="M12.04 2C6.57 2 2.13 6.44 2.13 11.91c0 1.73.45 3.42 1.3 4.9L2 22l5.33-1.4a9.86 9.86 0 0 0 4.71 1.2h.01c5.47 0 9.9-4.44 9.9-9.9C21.95 6.44 17.51 2 12.04 2zm5.76 14.3c-.24.68-1.4 1.3-1.92 1.38-.48.07-1.1.1-1.78-.11-.41-.13-.93-.3-1.6-.6-2.82-1.22-4.66-4.1-4.8-4.29-.13-.19-1.14-1.52-1.14-2.9 0-1.38.72-2.05.98-2.33.25-.28.56-.35.74-.35h.54c.17 0 .4-.03.62.47.24.58.81 2 .88 2.14.07.15.11.32.02.51-.08.19-.13.32-.26.49-.13.17-.27.38-.39.5-.13.13-.26.27-.11.52.15.25.68 1.12 1.46 1.81 1 .88 1.84 1.15 2.1 1.28.26.13.41.11.56-.06.15-.17.64-.74.81-1 .17-.26.34-.21.57-.13.24.08 1.5.71 1.75.84.26.13.43.19.49.3.06.11.06.64-.18 1.32z"/>
          </svg>
          Chiedi disponibilità
        </a>

        <a class="btn" href="tel:+390688936064" aria-label="Chiama">
          <svg class="i" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.8 19.8 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.8 19.8 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.8 12.8 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.8 12.8 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
          </svg>
          Chiama
        </a>

        <a class="btn"
           href="https://www.google.com/maps/dir/?api=1&destination=Via+Paolo+Mercuri+23+00047+Marino+RM"
           target="_blank" rel="noopener noreferrer"
           aria-label="Naviga">
          <svg class="i" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M21 10l-9 11-9-11a9 9 0 1 1 18 0z"/>
            <path d="M12 10.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z"/>
          </svg>
          Naviga
        </a>

        <button class="btn" type="button" id="saveContact" aria-label="Salva contatto">
          <svg class="i" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
            <circle cx="12" cy="7" r="4"/>
          </svg>
          Salva contatto
        </button>
      </div>

      <div class="section alt">
        <h2>Shop</h2>
        <div class="grid">
          <div class="tile">
            <svg class="i" viewBox="0 0 24 24" aria-hidden="true">
              <circle cx="12" cy="12" r="10"/>
              <line x1="2" y1="12" x2="22" y2="12"/>
              <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
            </svg>
            <div>
              <b>Sito ufficiale</b>
              <div class="small">
                <a href="https://aziendamoretti.com/" target="_blank" rel="noopener noreferrer">
                  Visita aziendamoretti.com
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="section">
        <h2>Dove ci trovi</h2>
        <div class="grid">
          <div class="tile">
            <svg class="i" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 21s-6-5.33-6-10a6 6 0 1 1 12 0c0 4.67-6 10-6 10z"/>
              <circle cx="12" cy="11" r="2"/>
            </svg>
            <div>
              <b>Azienda (Marino)</b>
              <div class="small">Via Paolo Mercuri, 23 · 00047 Marino (RM)</div>
              <div class="mini-actions">
                <a class="mini-btn" href="https://www.google.com/maps/search/?api=1&query=Via+Paolo+Mercuri+23+00047+Marino+RM"
                   target="_blank" rel="noopener noreferrer">Apri mappa</a>
                <a class="mini-btn" href="https://www.google.com/maps/dir/?api=1&destination=Via+Paolo+Mercuri+23+00047+Marino+RM"
                   target="_blank" rel="noopener noreferrer">Indicazioni</a>
              </div>
            </div>
          </div>

          <div class="tile">
            <svg class="i" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M12 21s-6-5.33-6-10a6 6 0 1 1 12 0c0 4.67-6 10-6 10z"/>
              <circle cx="12" cy="11" r="2"/>
            </svg>
            <div>
              <b>Store Eataly (Roma)</b>
              <div class="small">Piazzale 12 Ottobre 1492 · 00154 Roma (RM)</div>
              <div class="mini-actions">
                <a class="mini-btn" href="https://www.google.com/maps/search/?api=1&query=Piazzale+12+Ottobre+1492+00154+Roma+RM"
                   target="_blank" rel="noopener noreferrer">Apri mappa</a>
                <a class="mini-btn" href="https://www.google.com/maps/dir/?api=1&destination=Piazzale+12+Ottobre+1492+00154+Roma+RM"
                   target="_blank" rel="noopener noreferrer">Indicazioni</a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="section">
        <h2>Orari (Marino)</h2>
        <div class="grid">
          <div class="tile">
            <svg class="i" viewBox="0 0 24 24" aria-hidden="true">
              <circle cx="12" cy="12" r="10"/>
              <path d="M12 6v6l4 2"/>
            </svg>
            <div>
              <b>Apertura</b>
              <div class="hours" role="list">
                <div class="row" role="listitem"><span>Lun–Sab</span><span>09–13:30 · 16–20</span></div>
                <div class="row muted" role="listitem"><span>Dom</span><span>Chiuso</span></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="section alt">
        <h2>Le nostre produzioni</h2>
        <div class="grid">
          <div class="tile noicon">
            <div>
              <b>Funghi freschi</b>
              <div class="small">Selezione giornaliera da produzione propria, qualità e tracciabilità.</div>
            </div>
          </div>

          <div class="tile noicon">
            <div>
              <b>Linea gelo</b>
              <div class="small">Conservazione studiata per mantenere gusto e caratteristiche del prodotto.</div>
            </div>
          </div>

          <div class="tile noicon">
            <div>
              <b>Trasformati</b>
              <div class="small">Lavorazioni controllate e ricette pensate per valorizzare la materia prima.</div>
            </div>
          </div>

          <div class="tile noicon">
            <div>
              <b>Collaborazioni &amp; Forniture (B2B)</b>
              <div class="small">
                <a href="https://aziendamoretti.com/pages/collaborazioni" target="_blank" rel="noopener noreferrer">
                  Vai al form B2B
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="section">
        <h2>Video</h2>
        <div class="video" aria-label="Video di presentazione">
          <button type="button" id="loadVideo" aria-label="Riproduci video">
            <div class="play" aria-hidden="true">
              <span>
                <svg viewBox="0 0 24 24"><path d="M9 7v10l9-5-9-5z"/></svg>
              </span>
            </div>
          </button>
        </div>

        <div class="small" style="text-align:center;margin-top:10px;">
          Tocca per riprodurre (caricamento ottimizzato)
        </div>

        <!-- ✅ Fallback sempre funzionante -->
        <div style="text-align:center;margin-top:10px;">
          <a id="ytFallback" class="mini-btn" target="_blank" rel="noopener noreferrer"
             href="https://www.youtube.com/watch?v=bsgln3b1mOc">
            Guarda su YouTube
          </a>
        </div>
      </div>

      <div class="section alt">
        <h2>Social</h2>
        <div class="social-row">
          <a class="soc" href="https://www.facebook.com/p/Azienda-Agricola-Moretti-100054240050633/"
             target="_blank" rel="noopener noreferrer" aria-label="Facebook">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M14.5 8.5H16V6h-1.5C12.6 6 11.5 7.2 11.5 9v2H10v2.7h1.5V21h2.8v-7.3H16l.4-2.7h-2.1V9.3c0-.5.3-.8.8-.8z"/>
            </svg>
          </a>

          <a class="soc ig-open" href="https://www.instagram.com/azienda_agricola_moretti/"
             target="_blank" rel="noopener noreferrer" aria-label="Instagram" data-ig="azienda_agricola_moretti">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M16.5 2h-9A5.5 5.5 0 0 0 2 7.5v9A5.5 5.5 0 0 0 7.5 22h9A5.5 5.5 0 0 0 22 16.5v-9A5.5 5.5 0 0 0 16.5 2Zm3.2 14.5a3.2 3.2 0 0 1-3.2 3.2h-9a3.2 3.2 0 0 1-3.2-3.2v-9a3.2 3.2 0 0 1 3.2-3.2h9a3.2 3.2 0 0 1 3.2 3.2v9Z"/>
              <path d="M12 7.2A4.8 4.8 0 1 0 16.8 12 4.81 4.81 0 0 0 12 7.2Zm0 7.3A2.5 2.5 0 1 1 14.5 12 2.5 2.5 0 0 1 12 14.5Z"/>
              <path d="M17.5 6.4a1.1 1.1 0 1 0 1.1 1.1 1.1 1.1 0 0 0-1.1-1.1Z"/>
            </svg>
          </a>

          <a class="soc" href="https://www.tiktok.com/@aziendamoretti"
             target="_blank" rel="noopener noreferrer" aria-label="TikTok">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M16.5 3c1.2 1.7 2.9 2.9 4.9 3v3.1c-1.9-.1-3.7-.8-5.2-1.9v6.2a6 6 0 1 1-6-6c.4 0 .8 0 1.2.1v3.3a2.7 2.7 0 1 0 1.9 2.6V3h3.2z"/>
            </svg>
          </a>
        </div>
      </div>

    </div>
  </div>

  <div class="sticky" aria-label="Azioni rapide">
    <div class="inner">
      <a class="sbtn primary" id="waSticky" href="#" aria-label="WhatsApp">
        <svg class="wa-fill" viewBox="0 0 24 24" aria-hidden="true">
          <path fill="currentColor" d="M12.04 2C6.57 2 2.13 6.44 2.13 11.91c0 1.73.45 3.42 1.3 4.9L2 22l5.33-1.4a9.86 9.86 0 0 0 4.71 1.2h.01c5.47 0 9.9-4.44 9.9-9.9C21.95 6.44 17.51 2 12.04 2zm5.76 14.3c-.24.68-1.4 1.3-1.92 1.38-.48.07-1.1.1-1.78-.11-.41-.13-.93-.3-1.6-.6-2.82-1.22-4.66-4.1-4.8-4.29-.13-.19-1.14-1.52-1.14-2.9 0-1.38.72-2.05.98-2.33.25-.28.56-.35.74-.35h.54c.17 0 .4-.03.62.47.24.58.81 2 .88 2.14.07.15.11.32.02.51-.08.19-.13.32-.26.49-.13.17-.27.38-.39.5-.13.13-.26.27-.11.52.15.25.68 1.12 1.46 1.81 1 .88 1.84 1.15 2.1 1.28.26.13.41.11.56-.06.15-.17.64-.74.81-1 .17-.26.34-.21.57-.13.24.08 1.5.71 1.75.84.26.13.43.19.49.3.06.11.06.64-.18 1.32z"/>
        </svg>
        <span class="lbl">WhatsApp</span>
      </a>

      <a class="sbtn" href="tel:+390688936064" aria-label="Chiama">
        <svg class="i" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.8 19.8 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.8 19.8 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.8 12.8 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.8 12.8 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
        </svg>
        <span class="lbl">Chiama</span>
      </a>

      <a class="sbtn"
         href="https://www.google.com/maps/dir/?api=1&destination=Via+Paolo+Mercuri+23+00047+Marino+RM"
         target="_blank" rel="noopener noreferrer"
         aria-label="Naviga">
        <svg class="i" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M21 10l-9 11-9-11a9 9 0 1 1 18 0z"/>
          <path d="M12 10.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z"/>
        </svg>
        <span class="lbl">Naviga</span>
      </a>
    </div>
  </div>

  <script>
  (function(){
    // =========================
    // CONFIG (1 sola fonte verità)
    // =========================
    const CFG = {
      whatsappNumber: 'WHATSAPP_NUMBER', // <-- sostituisci con 39XXXXXXXXXX (senza +)
      whatsappMsgTop: 'Salve, ho scansionato il vostro QR code e vorrei informazioni su prodotti e disponibilità.',
      whatsappMsgSticky: 'Salve, ho scansionato il vostro QR code e vorrei informazioni.',
      instagramUser: 'azienda_agricola_moretti',
      youtubeId: 'bsgln3b1mOc'
    };

    // -------------------------
    // WhatsApp (centralizzato + validation)
    // -------------------------
    function sanitizeDigits(s){ return (s || '').replace(/\D/g, ''); }
    const waNum = sanitizeDigits(CFG.whatsappNumber);
    const waOk = /^[0-9]{8,15}$/.test(waNum);

    function waLink(message){
      const txt = encodeURIComponent(message || '');
      return 'https://wa.me/' + waNum + '?text=' + txt;
    }

    const waTop = document.getElementById('waTop');
    const waSticky = document.getElementById('waSticky');

    if(waTop){
      waTop.href = waOk ? waLink(CFG.whatsappMsgTop) : 'https://www.whatsapp.com/';
      if(!waOk) waTop.title = 'Numero WhatsApp non configurato';
    }
    if(waSticky){
      waSticky.href = waOk ? waLink(CFG.whatsappMsgSticky) : 'https://www.whatsapp.com/';
      if(!waOk) waSticky.title = 'Numero WhatsApp non configurato';
    }

    // -------------------------
    // Instagram deep link robusto + hardening username
    // -------------------------
    const igAnchor = document.querySelector('.ig-open');
    if(igAnchor){
      const rawUser = (igAnchor.getAttribute('data-ig') || CFG.instagramUser).trim();
      const okUser = /^[a-zA-Z0-9._]{1,30}$/.test(rawUser);
      const user = okUser ? rawUser : CFG.instagramUser;

      const web = 'https://www.instagram.com/' + user + '/';
      const ua = navigator.userAgent || '';
      const isAndroid = /Android/i.test(ua);
      const isIOS = /iPhone|iPad|iPod/i.test(ua);

      igAnchor.href = web;

      igAnchor.addEventListener('click', function(e){
        e.preventDefault();
        const fallback = () => { window.location.href = web; };

        if(isIOS){
          const ios = 'instagram://user?username=' + encodeURIComponent(user);
          const t = setTimeout(fallback, 900);
          window.location.href = ios;
          window.addEventListener('pagehide', () => clearTimeout(t), { once:true });
          window.addEventListener('blur', () => clearTimeout(t), { once:true });
          return;
        }

        if(isAndroid){
          const intent = 'intent://www.instagram.com/' + encodeURIComponent(user) +
            '/#Intent;package=com.instagram.android;scheme=https;end';
          const t = setTimeout(fallback, 900);
          window.location.href = intent;
          window.addEventListener('pagehide', () => clearTimeout(t), { once:true });
          window.addEventListener('blur', () => clearTimeout(t), { once:true });
          return;
        }

        fallback();
      });
    }

    // -------------------------
    // vCard download (cross-device)
    // -------------------------
    const btn = document.getElementById('saveContact');
    if(btn){
      const vcard =
`BEGIN:VCARD
VERSION:3.0
N:Moretti;Azienda Agricola;;;
FN:Azienda Agricola Moretti
ORG:Azienda Agricola Moretti
TITLE:Produzione e Forniture Funghi
TEL;TYPE=WORK,VOICE:+390688936064
EMAIL;TYPE=WORK:azienda.moretti@libero.it
ADR;TYPE=WORK:;;Via Paolo Mercuri 23;Marino;RM;00047;Italia
URL:https://aziendamoretti.com/
URL:https://www.instagram.com/azienda_agricola_moretti/
URL:https://www.facebook.com/p/Azienda-Agricola-Moretti-100054240050633/
URL:https://www.tiktok.com/@aziendamoretti
URL:https://aziendamoretti.com/pages/collaborazioni
END:VCARD`;

      btn.addEventListener('click', function(){
        const ua = navigator.userAgent || '';
        const isIOS = /iPhone|iPad|iPod/i.test(ua);

        if(isIOS){
          window.location.href = 'data:text/vcard;charset=utf-8,' + encodeURIComponent(vcard);
          return;
        }

        try{
          const blob = new Blob([vcard], { type: 'text/vcard;charset=utf-8' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'Azienda_Agricola_Moretti.vcf';
          a.rel = 'noopener';
          document.body.appendChild(a);
          a.click();

          setTimeout(() => {
            URL.revokeObjectURL(url);
            a.remove();
          }, 800);
        }catch(e){
          window.location.href = 'data:text/vcard;charset=utf-8,' + encodeURIComponent(vcard);
        }
      });
    }

    // -------------------------
    // ✅ VIDEO FIX: embed più compatibile + origin + fallback YouTube sempre
    // -------------------------
    const loadBtn = document.getElementById('loadVideo');
    const ytFallback = document.getElementById('ytFallback');

    if(loadBtn){
      // Aggiorna fallback link sempre coerente
      const watchUrl = 'https://www.youtube.com/watch?v=' + encodeURIComponent(CFG.youtubeId);
      if(ytFallback) ytFallback.href = watchUrl;

      loadBtn.addEventListener('click', function(){
        const container = loadBtn.parentElement;
        const yt = (CFG.youtubeId || '').trim();

        const origin = encodeURIComponent(window.location.origin);

        // Embed standard (più compatibile su iOS/Android/desktop)
        const embedUrl =
          'https://www.youtube.com/embed/' + encodeURIComponent(yt) +
          '?autoplay=1&rel=0&modestbranding=1&playsinline=1&origin=' + origin;

        const iframe = document.createElement('iframe');
        iframe.src = embedUrl;
        iframe.title = 'Azienda Agricola Moretti';
        iframe.allow = 'accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture; web-share';
        iframe.allowFullscreen = true;
        iframe.loading = 'lazy';
        iframe.referrerPolicy = 'origin-when-cross-origin';

        container.innerHTML = '';
        container.appendChild(iframe);
      });
    }
  })();
  </script>
</body>
</html>
